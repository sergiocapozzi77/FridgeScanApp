<ContentPage
    x:Class="FridgeScan.Views.RecipePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:sf="clr-namespace:Syncfusion.Maui.Cards;assembly=Syncfusion.Maui.Cards"
    xmlns:sfBusy="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
    xmlns:button="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
    xmlns:expander="clr-namespace:Syncfusion.Maui.Expander;assembly=Syncfusion.Maui.Expander"
    xmlns:chips="clr-namespace:Syncfusion.Maui.Toolkit.Chips;assembly=Syncfusion.Maui.Toolkit"
    xmlns:viewmodel="clr-namespace:FridgeScan.ViewModels">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid Padding="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Label
                FontAttributes="Bold"
                FontSize="24"
                HorizontalOptions="Start"
                VerticalTextAlignment="Center"
                Text="Suggested Recipes" />
            <button:SfButton
                Grid.Column="1"
                Command="{Binding LoadSuggestionsCommand}"
                FontFamily="Material"
                FontSize="18"
                Text="Refresh" />
        </Grid>

        <expander:SfExpander Grid.Row="1" Margin="10,0">
            <expander:SfExpander.Header>
                <Grid HeightRequest="40">
                    <Label Text="Filters" 
                   VerticalTextAlignment="Center" 
                   FontAttributes="Bold"
                   />
                </Grid>
            </expander:SfExpander.Header>
            <expander:SfExpander.Content>
                <VerticalStackLayout Padding="10" >
                    <Label Text="Select Meal Type:" FontAttributes="Bold" Margin="0,5" />

                    <chips:SfChipGroup 
                        ItemsSource="{Binding MealTypes}" 
                        SelectedItem="{Binding SelectedMealType, Mode=TwoWay}"
                        DisplayMemberPath="Label"
                        ChipType="Choice"
                        SelectedChipTextColor="White">

                        <chips:SfChipGroup.ChipLayout>
                            <FlexLayout 
                            Direction="Row" 
                            Wrap="Wrap" 
                            JustifyContent="Start" 
                            AlignContent="Start" 
                            AlignItems="Start" />
                        </chips:SfChipGroup.ChipLayout>
                    </chips:SfChipGroup>

                    <BoxView HeightRequest="1" Color="LightGray" Margin="0,5" />

                    <Label Text="Select Difficulty:" FontAttributes="Bold" Margin="0,0,0,20"/>
                    <chips:SfChipGroup 
                        ItemsSource="{Binding Difficulties}" 
                        SelectedItem="{Binding SelectedDifficulty, Mode=TwoWay}"
                        DisplayMemberPath="Label"
                        ChipType="Choice"
                        ChoiceMode="SingleOrNone">
                        <chips:SfChipGroup.ChipLayout>
                            <FlexLayout Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignContent="Start" />
                        </chips:SfChipGroup.ChipLayout>
                    </chips:SfChipGroup>

                    <BoxView HeightRequest="1" Color="LightGray" Margin="0,5" />

                    <Label Text="Total Time" FontAttributes="Bold" Margin="0,0,0,20" />
                    <chips:SfChipGroup 
                        ItemsSource="{Binding TotalTimes}" 
                        SelectedItem="{Binding SelectedTotalTime, Mode=TwoWay}"
                        DisplayMemberPath="Label"
                        ChipType="Choice"
                        ChoiceMode="SingleOrNone">
                        <chips:SfChipGroup.ChipLayout>
                            <FlexLayout Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignItems="Center" />
                        </chips:SfChipGroup.ChipLayout>
                    </chips:SfChipGroup>
                </VerticalStackLayout>
            </expander:SfExpander.Content>
        </expander:SfExpander>

        <expander:SfExpander Grid.Row="2" Margin="10,0,10,0">
            <expander:SfExpander.Header>
                <Grid HeightRequest="40">
                    <Label Text="Ingredients"
                   VerticalTextAlignment="Center"
                   FontAttributes="Bold" />
                </Grid>
            </expander:SfExpander.Header>

            <expander:SfExpander.Content>
                <VerticalStackLayout Padding="10">

                    <Label Text="Select Ingredients:"
                   FontAttributes="Bold"
                   Margin="0,5" />

                    <!-- Buttons Row -->
                    <HorizontalStackLayout Spacing="10" Margin="0,0,0,10">

                        <button:SfButton
                    Text="Select All"
                    Command="{Binding SelectAllIngredientsCommand}"
                    WidthRequest="120"
                    HeightRequest="36"
                    CornerRadius="6" />

                        <button:SfButton
                    Text="Deselect All"
                    Command="{Binding DeselectAllIngredientsCommand}"
                    WidthRequest="120"
                    HeightRequest="36"
                    CornerRadius="6" />
                    </HorizontalStackLayout>

                    <!-- Chips -->
                    <chips:SfChipGroup
                ItemsSource="{Binding AvailableIngredients}"
                SelectedItem="{Binding SelectedIngredients, Mode=TwoWay}"
                DisplayMemberPath="Name"
                ChipType="Filter"
                >

                        <chips:SfChipGroup.ChipLayout>
                            <FlexLayout Direction="Row"
                                Wrap="Wrap"
                                JustifyContent="Start"
                                AlignItems="Start" />
                        </chips:SfChipGroup.ChipLayout>

                    </chips:SfChipGroup>

                </VerticalStackLayout>
            </expander:SfExpander.Content>
        </expander:SfExpander>

        <expander:SfExpander Grid.Row="3" Margin="10,0,10,0">
            <expander:SfExpander.Header>
                <Grid HeightRequest="40">
                    <Label Text="Keywords"
                   VerticalTextAlignment="Center"
                   FontAttributes="Bold" />
                </Grid>
            </expander:SfExpander.Header>

            <expander:SfExpander.Content>
                <VerticalStackLayout Padding="10">

                    <Label Text="Add Keywords:"
                   FontAttributes="Bold"
                   Margin="0,5" />

                    <chips:SfChipGroup x:Name="KeywordsEntry"
                        ItemsSource="{Binding Keywords}"
                        ChipType="Input"
                        >
                        <!-- This enables typing new keywords -->
                        <chips:SfChipGroup.InputView>
                            <Entry Placeholder="Type a keyword and press Enter"
                           FontSize="14" Completed="Entry_Completed" />
                        </chips:SfChipGroup.InputView>

                        <chips:SfChipGroup.ChipLayout>
                            <FlexLayout Direction="Row"
                                Wrap="Wrap"
                                JustifyContent="Start"
                                AlignItems="Start" />
                        </chips:SfChipGroup.ChipLayout>

                    </chips:SfChipGroup>

                </VerticalStackLayout>
            </expander:SfExpander.Content>
        </expander:SfExpander>
        
        <ScrollView Grid.Row="4">
            <VerticalStackLayout Padding="16" Spacing="16">
                <CollectionView
                    ItemsSource="{Binding Suggestions}"
                    SelectedItem="{Binding SelectedSuggestion, Mode=TwoWay}"
                    SelectionMode="None"
                    >
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <sf:SfCardView
                                Margin="0,0,0,10"
                                CornerRadius="6">
                                <sf:SfCardView.GestureRecognizers>
                                    <TapGestureRecognizer 
            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:RecipeViewModel}}, Path=OpenRecipeCommand}"
            CommandParameter="{Binding}" />
                                </sf:SfCardView.GestureRecognizers>

                                <VerticalStackLayout Padding="2" Spacing="0">
                                    <Image
                                        Margin="0,0,0,4"
                                        Aspect="AspectFill"
                                        HeightRequest="140"
                                        Source="{Binding ImageUrl}" />

                                    <Label
                                        Margin="2,0,0,4"
                                        FontAttributes="Bold"
                                        FontSize="18"
                                        Text="{Binding Name}"
                                        LineBreakMode="CharacterWrap"
                                        MaxLines="1" />

                                    <HorizontalStackLayout Spacing="12" Margin="2,0,0,4">
                                        <Label
                                            FontSize="14"
                                            TextColor="Gray"
                                            Text="{Binding PrepTime, StringFormat='{0} minutes'}" />
                                        <Label
                                          FontSize="14"
                                          TextColor="Gray"
                                          Text="{Binding Difficulty}" />
                                        <Label
                                           FontSize="14"
                                           TextColor="Gray"
                                           Text="{Binding RecipeSource}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </sf:SfCardView>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <sfBusy:SfBusyIndicator Grid.Row="4"
            IsVisible="{Binding IsLoading}"
            IsRunning="{Binding IsLoading}"
            AnimationType="CircularMaterial"
            Title="Loading recipes..."
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="120"
            HeightRequest="90"
            BackgroundColor="#80000000" />
    </Grid>
</ContentPage>